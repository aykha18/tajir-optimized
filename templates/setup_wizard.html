<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tajir POS - Setup Wizard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .step-indicator { transition: all 0.3s ease; }
        .step-content { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .shop-type-card { transition: all 0.3s ease; }
        .shop-type-card:hover { transform: translateY(-2px); }
        .shop-type-card.selected { border-color: #6366f1; background-color: rgba(99, 102, 241, 0.1); }
        .plan-card.selected { border-color: #6366f1; background-color: rgba(99, 102, 241, 0.1); }
    </style>
</head>
<body class="bg-neutral-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-400 mb-2">Tajir POS Setup Wizard</h1>
            <p class="text-neutral-400">Let's get your business up and running quickly!</p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <span class="text-sm text-neutral-400">Step <span id="currentStep">1</span> of <span id="totalSteps">3</span></span>
                <span class="text-sm text-neutral-400" id="progressPercent">33%</span>
            </div>
            <div class="w-full bg-neutral-800 rounded-full h-2">
                <div id="progressBar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 33%"></div>
            </div>
        </div>

        <!-- Step Indicators -->
        <div class="flex justify-between mb-8">
            <div class="step-indicator flex flex-col items-center" data-step="1">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-semibold">1</div>
                <span class="text-xs mt-2 text-neutral-400">Shop Type</span>
            </div>
            <div class="step-indicator flex flex-col items-center opacity-50" data-step="2">
                <div class="w-10 h-10 rounded-full bg-neutral-700 flex items-center justify-center text-white font-semibold">2</div>
                <span class="text-xs mt-2 text-neutral-400">Shop Details</span>
            </div>
            <div class="step-indicator flex flex-col items-center opacity-50" data-step="3">
                <div class="w-10 h-10 rounded-full bg-neutral-700 flex items-center justify-center text-white font-semibold">3</div>
                <span class="text-xs mt-2 text-neutral-400">Complete</span>
            </div>
        </div>

        <!-- Step Content -->
        <div class="step-content">
            <!-- Step 1: Shop Type Selection -->
            <div id="step1" class="step-panel">
                <h2 class="text-2xl font-semibold mb-6">Choose Your Business Type</h2>
                <p class="text-neutral-400 mb-8">Select the type of business that best describes your shop:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="tailors">
                        <div class="text-3xl mb-3">üßµ</div>
                        <h3 class="font-semibold text-lg mb-2">Tailors</h3>
                        <p class="text-sm text-neutral-400">Clothing alterations and custom tailoring</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="laundry">
                        <div class="text-3xl mb-3">üßº</div>
                        <h3 class="font-semibold text-lg mb-2">Laundry / Dry Cleaners</h3>
                        <p class="text-sm text-neutral-400">Washing, dry cleaning, and pressing services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="salons">
                        <div class="text-3xl mb-3">ü™í</div>
                        <h3 class="font-semibold text-lg mb-2">Salons & Barbers</h3>
                        <p class="text-sm text-neutral-400">Hair styling, grooming, and beauty services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="mobile">
                        <div class="text-3xl mb-3">üì±</div>
                        <h3 class="font-semibold text-lg mb-2">Mobile/Repair Shops</h3>
                        <p class="text-sm text-neutral-400">Phone repair and mobile services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="electrical">
                        <div class="text-3xl mb-3">üßØ</div>
                        <h3 class="font-semibold text-lg mb-2">AC/Electrical Repair</h3>
                        <p class="text-sm text-neutral-400">Air conditioning and electrical services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="cafes">
                        <div class="text-3xl mb-3">üßÉ</div>
                        <h3 class="font-semibold text-lg mb-2">Small Cafes/Kiosks</h3>
                        <p class="text-sm text-neutral-400">Food and beverage services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="cobbler">
                        <div class="text-3xl mb-3">üë†</div>
                        <h3 class="font-semibold text-lg mb-2">Cobbler / Shoe Repair</h3>
                        <p class="text-sm text-neutral-400">Shoe repair and leather work</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="tuition">
                        <div class="text-3xl mb-3">üìö</div>
                        <h3 class="font-semibold text-lg mb-2">Tuition / Home Classes</h3>
                        <p class="text-sm text-neutral-400">Educational and tutoring services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="warehouse">
                        <div class="text-3xl mb-3">üì¶</div>
                        <h3 class="font-semibold text-lg mb-2">Mini Warehouses</h3>
                        <p class="text-sm text-neutral-400">Storage and logistics services</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="it">
                        <div class="text-3xl mb-3">üñ•Ô∏è</div>
                        <h3 class="font-semibold text-lg mb-2">IT Hardware Shops</h3>
                        <p class="text-sm text-neutral-400">Computer and technology sales</p>
                    </div>
                    
                    <div class="shop-type-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-type="perfume">
                        <div class="text-3xl mb-3">üß¥</div>
                        <h3 class="font-semibold text-lg mb-2">Perfume & Oud Shops</h3>
                        <p class="text-sm text-neutral-400">Fragrances and traditional scents</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Shop Details -->
            <div id="step2" class="step-panel hidden">
                <h2 class="text-2xl font-semibold mb-6">Shop Details</h2>
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6">
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <h3 class="text-blue-400 font-medium mb-1">Important</h3>
                            <p class="text-blue-300 text-sm">Please use unique contact information. If you get an error about duplicate data, try using a different phone number or email address.</p>
                        </div>
                    </div>
                </div>
                <form id="shopDetailsForm" class="space-y-6">
                    <!-- Row 1: Shop Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Shop Name *</label>
                            <input type="text" id="shopName" required class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Shop Owner Name *</label>
                            <input type="text" id="shopOwner" required class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Enter owner's full name">
                        </div>
                    </div>
                    
                    <!-- Row 2: Contact Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Contact Number *</label>
                            <input type="tel" id="contactNumber" required class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="e.g., 0501234567">
                            <p class="text-xs text-neutral-500 mt-1">Use a unique phone number that hasn't been registered before</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Email Address</label>
                            <input type="email" id="emailAddress" class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="e.g., owner@myshop.com">
                            <p class="text-xs text-neutral-500 mt-1">Optional - use a unique email or leave blank for auto-generated email</p>
                        </div>
                    </div>
                    
                    <!-- Row 3: Business Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">TRN (Tax Registration Number)</label>
                            <input type="text" id="shopTRN" class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-300 mb-2">Shop Address</label>
                            <textarea id="shopAddress" rows="3" class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Step 3: Plan Selection -->
            <div id="step3" class="step-panel hidden">
                <h2 class="text-2xl font-semibold mb-6">Choose Your Plan</h2>
                <p class="text-neutral-400 mb-8">Select the plan that best fits your business needs:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Tajir Trial -->
                    <div class="plan-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-plan="trial">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-semibold text-white mb-2">Tajir Trial</h3>
                            <div class="mb-4">
                                <span class="text-3xl font-bold text-white">Free</span>
                                <span class="text-neutral-400">15 days</span>
                                <div>Full PRO features</div>
                                <span class="text-neutral-400">No payment required</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Billing</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Product Management</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Customer Management</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Dashboard</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Customer Search</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Data backup/Restore</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">WhatsApp Bill</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tajir Basic -->
                    <div class="plan-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-plan="basic">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-semibold text-white mb-2">Tajir Basic</h3>
                            <div class="mb-4">
                                <span class="text-3xl font-bold text-white">AED 499</span>
                                <span class="text-sm text-neutral-500 block">Annual Subscription</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Billing</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Product Management</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Customer Management</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="lock" class="w-5 h-5 text-neutral-500"></svg>
                                <span class="text-neutral-500 ml-2">Dashboard</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="lock" class="w-5 h-5 text-neutral-500"></svg>
                                <span class="text-neutral-500 ml-2">Customer Search</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="lock" class="w-5 h-5 text-neutral-500"></svg>
                                <span class="text-neutral-500 ml-2">Data backup/Restore</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">WhatsApp Bill</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tajir PRO -->
                    <div class="plan-card border border-neutral-700 rounded-lg p-6 cursor-pointer hover:border-neutral-600" data-plan="pro">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-semibold text-white mb-2">Tajir PRO</h3>
                            <div class="mb-4">
                                <span class="text-3xl font-bold text-white">AED 899</span>
                                <span class="text-sm text-neutral-500 block">Annual subscription</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Everything in Basic</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">EmaraTax API Integration</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Real-time invoice validation</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Digital signature management</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">VAT return reports (VAT 201)</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Bulk invoice upload/download</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Branch-wise TRN configuration</span>
                            </div>
                            <div class="flex items-center">
                                <svg data-lucide="check" class="w-5 h-5 text-green-400"></svg>
                                <span class="text-neutral-300 ml-2">Priority support</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8">
            <button id="prevBtn" class="bg-neutral-700 hover:bg-neutral-600 text-white px-6 py-3 rounded-lg font-medium transition-colors hidden">
                Previous
            </button>
            <button id="nextBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium transition-colors ml-auto">
                Next
            </button>
        </div>
    </div>

    <!-- Credentials Modal -->
    <div id="credentialsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden backdrop-blur-sm p-4">
        <div class="bg-neutral-900/95 backdrop-blur border border-neutral-700 rounded-xl shadow-2xl p-8 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <!-- Success Icon -->
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
            </div>
            
            <!-- Title -->
            <h3 class="text-xl font-semibold text-white text-center mb-3">Setup Complete! üéâ</h3>
            
            <!-- Message -->
            <p class="text-neutral-300 text-center mb-6">Your shop has been created successfully. Here are your login credentials:</p>
            
            <!-- Credentials -->
            <div class="bg-neutral-800 rounded-lg p-4 mb-6">
                <div class="space-y-3">
                    <div>
                        <label class="text-sm text-neutral-400">Email/Mobile:</label>
                        <div class="flex items-center gap-2">
                            <input id="loginEmail" type="text" readonly class="flex-1 bg-neutral-700 border border-neutral-600 rounded px-3 py-2 text-white text-sm">
                            <button onclick="copyToClipboard('loginEmail')" class="bg-neutral-600 hover:bg-neutral-500 text-white px-3 py-2 rounded text-sm transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm text-neutral-400">Password:</label>
                        <div class="flex items-center gap-2">
                            <input id="loginPassword" type="text" readonly class="flex-1 bg-neutral-700 border border-neutral-600 rounded px-3 py-2 text-white text-sm">
                            <button onclick="copyToClipboard('loginPassword')" class="bg-neutral-600 hover:bg-neutral-500 text-white px-3 py-2 rounded text-sm transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Warning -->
            <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 mb-6">
                <p class="text-yellow-400 text-sm text-center">
                    ‚ö†Ô∏è Please save these credentials securely. You'll need them to login.
                </p>
            </div>
            
            <!-- Buttons -->
            <div class="flex gap-3">
                <button onclick="goToLogin()" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg px-6 py-3 font-medium transition-colors">
                    Go to Login
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 3;
        let setupData = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStepIndicators();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Shop type selection
            document.querySelectorAll('.shop-type-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.shop-type-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    setupData.shopType = this.getAttribute('data-type');
                });
            });

            // Plan selection
            document.querySelectorAll('.plan-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    setupData.selectedPlan = this.getAttribute('data-plan');
                });
            });

            // Navigation
            document.getElementById('nextBtn').addEventListener('click', nextStep);
            document.getElementById('prevBtn').addEventListener('click', prevStep);
        }

        function setupPlanEventListeners() {
            // Plan selection
            document.querySelectorAll('.plan-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    setupData.selectedPlan = this.getAttribute('data-plan');
                    console.log('Plan selected:', setupData.selectedPlan); // Debug log
                });
            });
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showCredentialsModal(result) {
            const modal = document.getElementById('credentialsModal');
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            
            // Set credentials - use actual email from response
            emailInput.value = result.emailAddress || (result.shop_code ? `shop_${result.shop_code}@tailorpos.com` : '');
            passwordInput.value = result.password || 'demo123';
            
            // Show modal with animation
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.bg-neutral-900\\/95').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            
            // Show feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            button.classList.add('bg-green-600');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600');
            }, 2000);
        }

        function goToLogin() {
            window.location.href = '/login';
        }

        async function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepIndicators();
                    showCurrentStep();
                } else {
                    await completeSetup();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepIndicators();
                showCurrentStep();
            }
        }

        function updateStepIndicators() {
            // Update progress
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';

            // Update step indicators
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                const stepNum = index + 1;
                const circle = indicator.querySelector('div');
                
                if (stepNum < currentStep) {
                    // Completed
                    circle.className = 'w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-white font-semibold';
                    indicator.className = 'step-indicator flex flex-col items-center';
                } else if (stepNum === currentStep) {
                    // Current
                    circle.className = 'w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-semibold';
                    indicator.className = 'step-indicator flex flex-col items-center';
                } else {
                    // Upcoming
                    circle.className = 'w-10 h-10 rounded-full bg-neutral-700 flex items-center justify-center text-white font-semibold';
                    indicator.className = 'step-indicator flex flex-col items-center opacity-50';
                }
            });

            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.classList.toggle('hidden', currentStep === 1);
            
            if (currentStep === totalSteps) {
                nextBtn.textContent = 'Complete Setup';
                nextBtn.className = 'bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg font-medium transition-colors ml-auto';
            } else {
                nextBtn.textContent = 'Next';
                nextBtn.className = 'bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium transition-colors ml-auto';
            }
        }

        function showCurrentStep() {
            // Hide all steps
            document.querySelectorAll('.step-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            // Show current step
            document.getElementById('step' + currentStep).classList.remove('hidden');
            
            // Re-setup event listeners for the current step
            if (currentStep === 3) {
                setupPlanEventListeners();
            }
        }

        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    if (!setupData.shopType) {
                        showToast('Please select a shop type', 'error');
                        return false;
                    }
                    break;
                case 2:
                    const shopName = document.getElementById('shopName').value.trim();
                    const shopOwner = document.getElementById('shopOwner').value.trim();
                    const contactNumber = document.getElementById('contactNumber').value.trim();
                    const emailAddress = document.getElementById('emailAddress').value.trim();
                    
                    if (!shopName) {
                        showToast('Please enter your shop name', 'error');
                        return false;
                    }
                    if (!shopOwner) {
                        showToast('Please enter the shop owner name', 'error');
                        return false;
                    }
                    if (!contactNumber) {
                        showToast('Please enter your contact number', 'error');
                        return false;
                    }
                    
                    // Email validation (if provided)
                    if (emailAddress && !isValidEmail(emailAddress)) {
                        showToast('Please enter a valid email address', 'error');
                        return false;
                    }
                    
                    setupData.shopInfo = {
                        name: shopName,
                        owner: shopOwner,
                        contactNumber: contactNumber,
                        email: emailAddress,
                        trn: document.getElementById('shopTRN').value.trim(),
                        address: document.getElementById('shopAddress').value.trim()
                    };
                    break;
                case 3:
                    if (!setupData.selectedPlan) {
                        showToast('Please select a plan', 'error');
                        return false;
                    }
                    break;
            }
            return true;
        }

        async function completeSetup() {
            try {
                // Prepare data for backend
                const backendData = {
                    shopType: setupData.shopType,
                    shopName: setupData.shopInfo.name,
                    shopOwner: setupData.shopInfo.owner,
                    contactNumber: setupData.shopInfo.contactNumber,
                    selectedPlan: setupData.selectedPlan,
                    emailAddress: setupData.shopInfo.email || '',
                    address: setupData.shopInfo.address,
                    trn: setupData.shopInfo.trn
                };

                // Show loading state
                const nextBtn = document.getElementById('nextBtn');
                const originalText = nextBtn.textContent;
                nextBtn.textContent = 'Setting up...';
                nextBtn.disabled = true;

                // Send data to backend
                const response = await fetch('/api/setup-wizard', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(backendData)
                });

                const result = await response.json();

                if (result.success) {
                    // Save setup data to localStorage
                    localStorage.setItem('tajirSetupComplete', 'true');
                    localStorage.setItem('tajirSetupData', JSON.stringify(setupData));
                    
                    // Show credentials modal
                    showCredentialsModal(result);
                } else {
                    throw new Error(result.message || 'Setup failed');
                }
            } catch (error) {
                console.error('Setup error:', error);
                
                // Show more helpful error message
                let errorMessage = error.message;
                if (errorMessage.includes('email is already registered')) {
                    errorMessage = 'This email is already registered. Please use a different email address or try logging in instead.';
                } else if (errorMessage.includes('contact number is already registered')) {
                    errorMessage = 'This phone number is already registered. Please use a different phone number.';
                } else if (errorMessage.includes('duplicate data')) {
                    errorMessage = 'Some information you entered is already in use. Please check your email and phone number, or try different values.';
                }
                
                showToast(errorMessage, 'error');
                
                // Reset button state
                const nextBtn = document.getElementById('nextBtn');
                nextBtn.textContent = 'Complete Setup';
                nextBtn.disabled = false;
                
                // If it's an email/phone conflict, go back to step 2 to let user fix it
                if (errorMessage.includes('email') || errorMessage.includes('phone')) {
                    currentStep = 2;
                    updateStepIndicators();
                    showCurrentStep();
                }
            }
        }

        function showToast(message, type = 'info') {
            // Simple toast implementation
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html> 