{% extends "base.html" %}

{% block title %}Plan Debug{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-10 px-6">
    <h1 class="text-3xl font-bold mb-8">üîç Plan Management Debug</h1>
    
    <div class="grid gap-6">
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">1. Test Plan Status API</h2>
            <button onclick="testPlanStatus()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg">
                Test /api/plan/status
            </button>
            <div id="planStatusResult" class="mt-4"></div>
        </div>
        
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">2. Test Plan Config API</h2>
            <button onclick="testPlanConfig()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg">
                Test /api/plan/config
            </button>
            <div id="planConfigResult" class="mt-4"></div>
        </div>
        
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">3. Test Features API</h2>
            <button onclick="testFeatures()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg">
                Test /api/plan/features
            </button>
            <div id="featuresResult" class="mt-4"></div>
        </div>
        
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">4. Test Feature Check</h2>
            <button onclick="testFeatureCheck('dashboard')" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg mr-2">
                Test dashboard access
            </button>
            <button onclick="testFeatureCheck('billing')" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg">
                Test billing access
            </button>
            <div id="featureCheckResult" class="mt-4"></div>
        </div>
        
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">5. Expire Trial (Set to 16 days ago)</h2>
            <button onclick="expireTrial()" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg">
                Expire Trial
            </button>
            <div id="expireResult" class="mt-4"></div>
        </div>
        
        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">6. Reset Trial (Set to today)</h2>
            <button onclick="resetTrial()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg">
                Reset Trial
            </button>
            <div id="resetResult" class="mt-4"></div>
        </div>

        <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">7. Change Plan Type</h2>
            <button onclick="changePlan('trial')" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg mr-2">Set Trial</button>
            <button onclick="changePlan('basic')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg mr-2">Set Basic</button>
            <button onclick="changePlan('pro')" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg">Set PRO</button>
            <div id="changePlanResult" class="mt-4"></div>
        </div>
    </div>
</div>

<script>
    async function testPlanStatus() {
        const result = document.getElementById('planStatusResult');
        result.innerHTML = '<p class="text-yellow-400">Testing...</p>';
        
        try {
            const response = await fetch('/api/plan/status');
            const data = await response.json();
            
            result.innerHTML = `
                <p class="text-green-400">‚úÖ API Response:</p>
                <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
            `;
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function testPlanConfig() {
        const result = document.getElementById('planConfigResult');
        result.innerHTML = '<p class="text-yellow-400">Testing...</p>';
        
        try {
            const response = await fetch('/api/plan/config');
            const data = await response.json();
            
            result.innerHTML = `
                <p class="text-green-400">‚úÖ API Response:</p>
                <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
            `;
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function testFeatures() {
        const result = document.getElementById('featuresResult');
        result.innerHTML = '<p class="text-yellow-400">Testing...</p>';
        
        try {
            const response = await fetch('/api/plan/features');
            const data = await response.json();
            
            result.innerHTML = `
                <p class="text-green-400">‚úÖ API Response:</p>
                <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
            `;
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function testFeatureCheck(feature) {
        const result = document.getElementById('featureCheckResult');
        result.innerHTML = '<p class="text-yellow-400">Testing...</p>';
        
        try {
            const response = await fetch(`/api/plan/check-feature/${feature}`);
            const data = await response.json();
            
            result.innerHTML = `
                <p class="text-green-400">‚úÖ ${feature} access check:</p>
                <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
            `;
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function expireTrial() {
        const result = document.getElementById('expireResult');
        result.innerHTML = '<p class="text-yellow-400">Expiring trial...</p>';
        
        try {
            const response = await fetch('/api/plan/expire-trial', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ days_ago: 16 })
            });
            
            if (response.ok) {
                const data = await response.json();
                result.innerHTML = `
                    <p class="text-green-400">‚úÖ Trial expired:</p>
                    <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
                `;
            } else {
                throw new Error('Failed to expire trial');
            }
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function resetTrial() {
        const result = document.getElementById('resetResult');
        result.innerHTML = '<p class="text-yellow-400">Resetting trial...</p>';
        
        try {
            const response = await fetch('/api/plan/reset-trial', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            if (response.ok) {
                const data = await response.json();
                result.innerHTML = `
                    <p class="text-green-400">‚úÖ Trial reset:</p>
                    <pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
                `;
            } else {
                throw new Error('Failed to reset trial');
            }
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }

    async function changePlan(planType) {
        const result = document.getElementById('changePlanResult');
        result.innerHTML = `<p class="text-yellow-400">Changing plan to <b>${planType.toUpperCase()}</b>...</p>`;
        try {
            const response = await fetch('/api/plan/upgrade', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plan_type: planType })
            });
            if (response.ok) {
                const data = await response.json();
                result.innerHTML = `<p class="text-green-400">‚úÖ Plan changed to <b>${planType.toUpperCase()}</b>:</p><pre class="bg-neutral-900 p-4 rounded-lg overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                throw new Error('Failed to change plan');
            }
        } catch (error) {
            result.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
        }
    }
</script>
{% endblock %} 