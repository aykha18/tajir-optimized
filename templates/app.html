{% extends "base.html" %}

{% block title %}Tajir - Application{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@4.1.0/dist/chartjs-chart-matrix.umd.min.js"></script>
<!-- CSS moved to external files: main.css and animations.css -->

<!-- Billing UI enhancements (scoped to mobile billing container) -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/billing-ui-enhanced.css') }}">
<!-- Mobile enhancements and navigation -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-enhancements.css', v='1.0.1') }}">
<!-- Main CSS with aggressive element hiding -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css', v='1.0.1') }}">

<!-- Custom VAT Icon Positioning (scoped, non-intrusive) -->
<style>
  .vat-inline {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }
</style>

<!-- Custom JavaScript Files -->
<script src="{{ url_for('static', filename='js/app.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/product-types.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/products.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/customers.js', v='1.0.7') }}"></script>
<script src="{{ url_for('static', filename='js/modules/vat.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/vat-config.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/employees.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/plan-management.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/reports.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/shop-settings.js', v='1.0.30') }}"></script>

<script src="{{ url_for('static', filename='js/modules/dashboard.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/config.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/ui.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/country-code.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/totals.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/customer.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/items.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing-system.js', v='1.0.5') }}"></script>
    <script src="{{ url_for('static', filename='js/modules/billing/actions.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/search-reprint.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/master-autocomplete.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/city-area-autocomplete.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/billing/vat-listeners.js', v='1.0.0') }}"></script>
<script src="{{ url_for('static', filename='js/modules/mobile-enhancements.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/mobile-screens.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/mobile-navigation.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/mobile-billing.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/account.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/catalog-scanner.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/ocr-scanner.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/barcode-scanner.js', v='1.0.5') }}"></script>
<script src="{{ url_for('static', filename='js/modules/loyalty-program.js', v='1.0.5') }}"></script>
{% endblock %}

{% block content %}
<div class="flex min-h-screen">
  <!-- SIDEBAR -->
  {% include 'partials/sidebar.html' %}


  <!-- MAIN -->
  <main class="flex-1 overflow-y-auto fade-in w-full" style="animation-delay:.12s">
    <!-- Mobile Menu Toggle (only visible on mobile) -->
    <div class="lg:hidden p-4 border-b border-neutral-800">
      <button id="mobileMenuToggle"
        class="p-2 rounded-lg border border-neutral-700 hover:bg-neutral-800 focus-visible:ring-2 focus-visible:ring-indigo-400/60 mobile-btn">
        <div class="w-4 h-4 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-sm flex items-center justify-center">
          <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd" />
          </svg>
        </div>
      </button>
    </div>

    <!-- CONTENT -->
    <div class="px-6 py-4 mobile-container">
      <!-- Mobile Billing Recommendation Banner (only on mobile) -->
      <div id="mobileBillingBanner"
        class="md:hidden mb-4 p-4 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-lg border border-blue-500">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-white font-semibold text-sm">ðŸ“± Use Mobile Billing for Better Experience</h3>
              <p class="text-blue-100 text-xs">Touch-friendly interface with enhanced features</p>
            </div>
          </div>
          <button id="mobileBillingBannerBtn" data-testid="mobile-billing-banner-btn"
            class="bg-white text-blue-600 px-3 py-1 rounded-lg text-xs font-semibold hover:bg-blue-50 transition-colors">
            Try Now
          </button>
        </div>
      </div>

      <!-- BILLING -->
      <section id="billingSec" class="page space-y-2 mobile-form w-full max-w-none">
        <div class="flex justify-between items-center">
          <h3 class="text-2xl font-semibold tracking-tight">Billing</h3>
          <div class="flex gap-2">
            <button id="searchInvoiceBtn" data-testid="search-invoice-btn" class="modern-btn modern-btn-secondary mobile-btn">
              <svg data-lucide="search" class="w-4 h-4"></svg>
              Search & Reprint
            </button>
          </div>
        </div>

        <!-- BILLING LAYOUT - Two Column -->
        <div class="grid grid-cols-1 lg:grid-cols-6 gap-4">
          <!-- LEFT COLUMN - Billing Form -->
          <div class="lg:col-span-5">
            <!-- BILLING FORM - Compact Layout -->
            <div class="modern-card">
              <h4 class="text-xs font-medium text-neutral-300 mb-2">META</h4>
              {% include 'partials/billing/meta_form.html' %}
            </div>
          </div>

          {% include 'partials/billing/recent_customers.html' %}
        </div>

        {% include 'partials/billing/add_product.html' %}

        {% include 'partials/billing/items_table.html' %}

        {% include 'partials/billing/totals_panel.html' %}

        {% include 'partials/billing/actions_bar.html' %}
      </section>

      {% include 'partials/modals/search_invoice.html' %}

      {% include 'partials/modals/vat_config.html' %}

      {% include 'partials/dashboard/main.html' %}

      {% include 'partials/reports/main.html' %}

      <!-- UNIFIED PRODUCTS SECTION -->
      {% include 'partials/products/main.html' %}

      <!-- CUSTOMERS -->
      {% include 'partials/customers/main.html' %}

      {% include 'partials/employees/main.html' %}

      <!-- LOYALTY PROGRAM -->
      {% include 'partials/loyalty/main.html' %}
      <!-- SHOP SETTINGS (Compact, Mobile-Friendly) -->
      {% include 'partials/settings/main.html' %}

    </div>
  </main>
</div>
<!-- Modern Confirmation Modal -->
{% include 'partials/modals/confirm.html' %}
<!-- Payment Progress Modal -->
{% include 'partials/modals/payment_progress.html' %}
<!-- Payment Modal -->
{% include 'partials/modals/payment.html' %}
<!-- Main Container -->
{% endblock %}
{% block extra_scripts %}
{{ super() }}
<!-- JavaScript moved to external files: app.js and modules/ -->
{% include 'partials/scripts/mobile_init.html' %}
{% include 'partials/mobile/billing_v3.html' %}
<!-- Product Tab Switching Function moved to app.js -->
{% include 'partials/modals/change_password.html' %}
{% include 'partials/scripts/billing_notes.html' %}

{% endblock %}
